!function e(t,o,r){function i(a,s){if(!o[a]){if(!t[a]){var l="function"==typeof require&&require;if(!s&&l)return l(a,!0);if(n)return n(a,!0);var d=new Error("Cannot find module '"+a+"'");throw d.code="MODULE_NOT_FOUND",d}var c=o[a]={exports:{}};t[a][0].call(c.exports,function(e){var o=t[a][1][e];return i(o?o:e)},c,c.exports,e,t,o,r)}return o[a].exports}for(var n="function"==typeof require&&require,a=0;a<r.length;a++)i(r[a]);return i}({1:[function(e,t,o){"use strict";var r=e("jquery"),i=(e("foundation-sites"),e("underscore"),e("backbone"));i.$=r;var n=e("backbone.marionette"),a=new n.Application,s=e("./lib/router"),l=e("./lib/mainController");a.addInitializer(function(){r(document).foundation(),new s({controller:l}),i.history.start({pushState:!0})}),a.start()},{"./lib/mainController":2,"./lib/router":11,backbone:"backbone","backbone.marionette":"backbone.marionette","foundation-sites":"foundation-sites",jquery:"jquery",underscore:"underscore"}],2:[function(e,t,o){t.exports={top:e("./top/controller"),mypage:e("./mypage/controller")}},{"./mypage/controller":4,"./top/controller":12}],3:[function(e,t,o){var r=e("backbone"),i=e("./../model/searchResult");t.exports=r.Collection.extend({url:null,model:i})},{"./../model/searchResult":6,backbone:"backbone"}],4:[function(e,t,o){{var r=(e("jquery"),e("backbone"),e("./view/searchResults"));e("./collection/searchResults")}t.exports=function(){var e=new r;e.render()}},{"./collection/searchResults":3,"./view/searchResults":10,backbone:"backbone",jquery:"jquery"}],5:[function(e,t,o){var r=e("backbone");t.exports=r.Model.extend({urlRoot:function(){return this.get("start_num")?"/api/search/count/"+this.get("start_num"):"/api/search/count/"},"default":{total_items:0,start_num:0,end_num:0},parse:function(e){return e.result}})},{backbone:"backbone"}],6:[function(e,t,o){var r=e("backbone");t.exports=r.Model.extend({urlRoot:null,"default":{id:"",user_id:"",title:"",start:"",end:"",keyword:"",mode:"",radius:"",search_url:"",google_maps_img_url:""}})},{backbone:"backbone"}],7:[function(e,t,o){var r=e("underscore");t.exports={listContainer:r.template('<div id="item-description"><span class="info label">登録件数</span> <span id="total-items">計 <%= total_items %> 件</span><% if(total_items > 1){ %><span id="items-from-to">（<%= start_num %> 件目 〜 <%= end_num %> 件目）</span><% } %></div><ul id="search-result-lists" class="small-block-grid-1 medium-block-grid-2 large-block-grid-3"></ul>'),listUnit:r.template('<table class="search-result-title" data-id=<%= id %>><thead><tr><th><%- title %></th></tr></thead></table><a href="<%= search_url %>"><img class="th" src="<%= google_maps_img_url %>"></a><table class="search-result-detail"><tbody><tr><td colspan=2><a href="<%- search_url %>" class="button small radius"><i class="fa fa-share"></i> 検索結果を表示する</a></td></tr><tr><td class="grid-3"><strong>出発地</strong></td><td><%- start %></td></tr><tr><td class="grid-3"><strong>目的地</strong></td><td><%- end %></td></tr><tr><td class="grid-3"><strong>検索ワード</strong></td><td><%- keyword %></td></tr><tr><td class="grid-3"><strong>移動手段</strong></td><td><%= mode %></td></tr><tr><td class="grid-3"><strong>検索半径</strong></td><td><%= radius %></td></tr><tr><td colspan=2><a href="#" class="search-result-delete"><i class="fa fa-trash"></i></a><a href="#" class="search-result-edit"><i class="fa fa-pencil-square-o"></i></a></td></tr></tbody></table>'),empty:'<div data-alert class="alert-box warning radius"><strong><i class="fa fa-exclamation-circle"></i> 検索履歴が登録されていません。</strong><br>検索結果を登録することで、再び検索条件を入力することなくすぐに検索結果にアクセスできるようになります。</div>'}},{underscore:"underscore"}],8:[function(e,t,o){var r=e("backbone.marionette"),i=e("./../template/index");t.exports=r.ItemView.extend({tagName:"div",className:"alert-box warning radius",template:i.empty})},{"./../template/index":7,"backbone.marionette":"backbone.marionette"}],9:[function(e,t,o){var r=e("backbone.marionette"),i=e("jquery"),n=(e("foundation-sites"),e("./../template/index"));t.exports=r.ItemView.extend({tagName:"li",className:"search-result-list",template:n.listUnit,model:null,$editModal:null,ui:{title:".search-result-title",editLink:".search-result-edit",deleteLink:".search-result-delete"},events:{"click @ui.editLink":"edit","click @ui.deleteLink":"delete"},initialize:function(){this.bindUIElements(),this.$editModal=i("#modal-search-result-title-edit"),this.$deleteModal=i("#modal-search-result-delete")},edit:function(e){e.preventDefault(),this.$editModal.find("#form_title").val(this.model.get("title")),this.$editModal.foundation("reveal","open"),this.$editModal.find("#form_title").keyup(this.observeEditInput),this.$editModal.on("submit",{that:this},this.editSubmit),this.$editModal.on("closed.fndtn.reveal",this.closeEditModal)},observeEditInput:function(e){var t=i(this);if(1!=t.data("submit-flag")){var o=t.val().length;$button=i("#button-search-result-save"),o>0&&50>=o?$button.removeAttr("disabled"):(0==o||o>50)&&$button.attr("disabled",!0)}},editSubmit:function(e){e.preventDefault(),e.data.that.editConfirm()},editConfirm:function(){var e=this,t=this.$editModal.find("button");this.model.set({title:this.$editModal.find("#form_title").val()}),this.model.save(null,{url:"/api/search/save_title/"+this.model.get("id"),timeout:6e4,beforeSend:function(){t.attr("disabled",!0)},success:function(t,o){e.$editModal.find("#search-result-title-edit-success").show("slow"),e.ui.title.find("th").text(t.get("title")),e.$editModal.find("#form_title").data("submit-flag",1)},error:function(t,o){var r=e.$editModal.find("#search-result-title-edit-error"),i=o.statusText;void 0!=o.responseJSON&&void 0!=o.responseJSON.message&&(i=o.responseJSON.message),r.find(".error-message").empty().text(i),r.show("slow")}})},closeEditModal:function(){var e=i(this);e.find("#search-result-title-edit-success").hide(),e.find("#search-result-title-edit-error").hide(),e.find("button").removeAttr("disabled"),e.find("#form_title").data("submit-flag",0),e.find("#form_title").off("keyup"),e.off("submit"),e.off("closed.fndtn.reveal")},"delete":function(e){e.preventDefault(),this.$deleteModal.foundation("reveal","open"),this.$deleteModal.on("submit",{that:this},this.deleteSubmit),this.$deleteModal.on("closed.fndtn.reveal",this.closeDeleteModal)},deleteSubmit:function(e){e.preventDefault(),e.data.that.deleteConfirm()},deleteConfirm:function(){var e=this,t=this.$deleteModal.find("button");this.model.destroy({url:"/api/search/delete/"+this.model.get("id"),timeout:6e4,beforeSend:function(){t.attr("disabled",!0)},success:function(t,o){e.destroy()},error:function(t,o){var r=e.$deleteModal.find("#search-result-delete-error"),i=o.statusText;void 0!=o.responseJSON&&void 0!=o.responseJSON.message&&(i=o.responseJSON.message),r.find(".error-message").empty().text(i),r.show("slow")}})},onBeforeDestroy:function(){this.$deleteModal.foundation("reveal","close"),this.$el.hide("slow")},closeDeleteModal:function(){var e=i(this);e.find("#search-result-delete-error").hide(),e.find("button").removeAttr("disabled"),e.off("submit"),e.off("closed.fndtn.reveal")}})},{"./../template/index":7,"backbone.marionette":"backbone.marionette","foundation-sites":"foundation-sites",jquery:"jquery"}],10:[function(e,t,o){var r=e("backbone.marionette"),i=(e("backbone"),e("jquery")),n=e("./../template/index"),a=e("./searchResult"),s=e("./empty"),l=e("./../collection/searchResults"),d=e("./../model/pagination");t.exports=r.CompositeView.extend({el:"div#search-result-container",template:n.listContainer,model:null,collection:null,childView:a,childViewContainer:"ul#search-result-lists",emptyView:s,initialize:function(){var e=JSON.parse(i("#pagination-info").text());this.model=new d(e);var t=JSON.parse(i("#search-results-info").text());this.collection=new l(t)},onRemoveChild:function(){{var e=this;this.collection.length}this.model.fetch({success:function(t,o){if(t.get("total_items")-t.get("end_num")>0)e.addSearchResult();else if(t.get("end_num")%9==0){var r=document.URL;r.test(/\/\d+$/)&&r.replace(/\/(\d+)/,function(e){var t=e-1;return"/"+t}),location.href=r}},error:function(e,t){}})},addSearchResult:function(){console.log("addSearchResult"),console.log(this)}})},{"./../collection/searchResults":3,"./../model/pagination":5,"./../template/index":7,"./empty":8,"./searchResult":9,backbone:"backbone","backbone.marionette":"backbone.marionette",jquery:"jquery"}],11:[function(e,t,o){var r=e("backbone.marionette");t.exports=r.AppRouter.extend({appRoutes:{"":"top",top:"top",mypage:"mypage","mypage/index":"mypage"}})},{"backbone.marionette":"backbone.marionette"}],12:[function(e,t,o){var r=(e("jquery"),e("./view/searchBox"));t.exports=function(){new r}},{"./view/searchBox":14,jquery:"jquery"}],13:[function(e,t,o){var r=e("underscore");t.exports={loader:r.template('<div id="over-lay"></div><div id="search-loader"><i class="fa fa-spinner fa-pulse"></i></div>')}},{underscore:"underscore"}],14:[function(e,t,o){var r=e("jquery"),i=e("backbone.marionette"),n=e("./searchLoader");t.exports=i.ItemView.extend({el:"#search-box",ui:{formSearch:"#form-search",formSearchButton:"#form-search-button"},template:!1,events:{"submit @ui.formSearch":"submitForm"},initialize:function(){this.bindUIElements(),this._initAutoComplete()},_initAutoComplete:function(){google.maps.event.addDomListener(window,"load",function(){var e=document.getElementById("form_start"),t=document.getElementById("form_end"),o={types:[],componentRestrictions:{country:"jp"}};new google.maps.places.Autocomplete(e,o),new google.maps.places.Autocomplete(t,o)})},submitForm:function(){if(this.ui.formSearch.blur(),this.ui.formSearchButton.attr("disabled",!0),null!=document.getElementById("over-lay"))return!1;var e=new n;e.render(),r(window).on("resize",function(){e.triggerMethod("resize")})}})},{"./searchLoader":15,"backbone.marionette":"backbone.marionette",jquery:"jquery"}],15:[function(e,t,o){var r=e("jquery"),i=e("backbone.marionette"),n=e("./../template/loader");t.exports=i.ItemView.extend({el:"#show-loader",ui:{overLay:"#over-lay",searchLoader:"#search-loader"},template:n.loader,onRender:function(){this.bindUIElements(),this._centeringLoader(),this.ui.overLay.fadeIn("normal"),this.ui.searchLoader.fadeIn("normal")},onResize:function(){this._centeringLoader()},_centeringLoader:function(){var e=(r(window).width()-this.ui.searchLoader.outerWidth(!0))/2,t=(window.innerHeight-this.ui.searchLoader.outerHeight(!0))/2;this.ui.searchLoader.css({left:e+"px"}),this.ui.searchLoader.css({top:t+"px"})}})},{"./../template/loader":13,"backbone.marionette":"backbone.marionette",jquery:"jquery"}]},{},[1]);