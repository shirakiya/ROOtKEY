!function e(t,o,i){function r(n,s){if(!o[n]){if(!t[n]){var l="function"==typeof require&&require;if(!s&&l)return l(n,!0);if(a)return a(n,!0);var d=new Error("Cannot find module '"+n+"'");throw d.code="MODULE_NOT_FOUND",d}var u=o[n]={exports:{}};t[n][0].call(u.exports,function(e){var o=t[n][1][e];return r(o?o:e)},u,u.exports,e,t,o,i)}return o[n].exports}for(var a="function"==typeof require&&require,n=0;n<i.length;n++)r(i[n]);return r}({1:[function(e,t,o){"use strict";var i=e("jquery"),r=(e("foundation-sites"),e("underscore"),e("backbone"));r.$=i;var a=e("backbone.marionette"),n=new a.Application,s=e("./lib/router"),l=e("./lib/mainController");n.addInitializer(function(){i(document).foundation(),new s({controller:l}),r.history.start({pushState:!0})}),n.start()},{"./lib/mainController":2,"./lib/router":11,backbone:"backbone","backbone.marionette":"backbone.marionette","foundation-sites":"foundation-sites",jquery:"jquery",underscore:"underscore"}],2:[function(e,t,o){t.exports={top:e("./top/controller"),mypage:e("./mypage/controller")}},{"./mypage/controller":4,"./top/controller":12}],3:[function(e,t,o){var i=e("backbone"),r=e("./../model/searchResult");t.exports=i.Collection.extend({url:null,model:r})},{"./../model/searchResult":6,backbone:"backbone"}],4:[function(e,t,o){{var i=(e("jquery"),e("backbone"),e("./view/searchResults"));e("./collection/searchResults")}t.exports=function(){var e=new i;e.render()}},{"./collection/searchResults":3,"./view/searchResults":10,backbone:"backbone",jquery:"jquery"}],5:[function(e,t,o){var i=e("backbone");t.exports=i.Model.extend({urlRoot:null,"default":{total_items:0}})},{backbone:"backbone"}],6:[function(e,t,o){var i=e("backbone");t.exports=i.Model.extend({urlRoot:"api/search/prev_one/","default":{id:"",user_id:"",title:"",start:"",end:"",keyword:"",mode:"",radius:"",search_url:"",google_maps_img_url:""},parse:function(e){return null!=e.data?e.data:void 0}})},{backbone:"backbone"}],7:[function(e,t,o){var i=e("underscore");t.exports={listContainer:i.template('<div id="item-description"><span class="info label">登録件数</span> <span id="total-items">計 <%= total_items %> 件</span></div><ul id="search-result-lists" class="small-block-grid-1 medium-block-grid-2 large-block-grid-3"></ul>'),listUnit:i.template('<table class="search-result-title" data-id=<%= id %>><thead><tr><th><%- title %></th></tr></thead></table><a href="<%= search_url %>"><img class="th" src="<%= google_maps_img_url %>"></a><table class="search-result-detail"><tbody><tr><td colspan=2><a href="<%- search_url %>" class="button small radius"><i class="fa fa-share"></i> 検索結果を表示する</a></td></tr><tr><td class="grid-3"><strong>出発地</strong></td><td><%- start %></td></tr><tr><td class="grid-3"><strong>目的地</strong></td><td><%- end %></td></tr><tr><td class="grid-3"><strong>検索ワード</strong></td><td><%- keyword %></td></tr><tr><td class="grid-3"><strong>移動手段</strong></td><td><%= mode %></td></tr><tr><td class="grid-3"><strong>検索半径</strong></td><td><%= radius %></td></tr><tr><td colspan=2><a href="#" class="search-result-delete"><i class="fa fa-trash"></i></a><a href="#" class="search-result-edit"><i class="fa fa-pencil-square-o"></i></a></td></tr></tbody></table>'),empty:'<div data-alert class="alert-box warning radius"><strong><i class="fa fa-exclamation-circle"></i> 検索履歴が登録されていません。</strong><br>検索結果を登録することで、再び検索条件を入力することなくすぐに検索結果にアクセスできるようになります。</div>'}},{underscore:"underscore"}],8:[function(e,t,o){var i=e("backbone.marionette"),r=e("./../template/index");t.exports=i.ItemView.extend({tagName:"div",className:"alert-box warning radius",template:r.empty})},{"./../template/index":7,"backbone.marionette":"backbone.marionette"}],9:[function(e,t,o){var i=e("backbone.marionette"),r=e("jquery"),a=(e("foundation-sites"),e("./../template/index"));t.exports=i.ItemView.extend({tagName:"li",className:"search-result-list",template:a.listUnit,model:null,$editModal:null,ui:{title:".search-result-title",editLink:".search-result-edit",deleteLink:".search-result-delete"},events:{"click @ui.editLink":"edit","click @ui.deleteLink":"delete"},initialize:function(){this.bindUIElements(),this.$editModal=r("#modal-search-result-title-edit"),this.$deleteModal=r("#modal-search-result-delete")},edit:function(e){e.preventDefault(),this.$editModal.find("#form_title").val(this.model.get("title")),this.$editModal.foundation("reveal","open"),this.$editModal.find("#form_title").keyup(this.observeEditInput),this.$editModal.on("submit",{self:this},this.editSubmit),this.$editModal.on("closed.fndtn.reveal",this.closeEditModal)},observeEditInput:function(e){var t=r(this);if(1!=t.data("submit-flag")){var o=t.val().length;$button=r("#button-search-result-save"),o>0&&50>=o?$button.removeAttr("disabled"):(0==o||o>50)&&$button.attr("disabled",!0)}},editSubmit:function(e){e.preventDefault(),e.data.self.editConfirm()},editConfirm:function(){var e=this,t=this.$editModal.find("button");this.model.set({title:this.$editModal.find("#form_title").val()}),this.model.save(null,{url:"/api/search/save_title/"+this.model.get("id"),timeout:6e4,beforeSend:function(){t.attr("disabled",!0)},success:function(t,o){e.$editModal.find("#search-result-title-edit-success").show("slow"),e.ui.title.find("th").text(t.get("title")),e.$editModal.find("#form_title").data("submit-flag",1)},error:function(t,o){var i=e.$editModal.find("#search-result-title-edit-error"),r=o.statusText;void 0!=o.responseJSON&&void 0!=o.responseJSON.message&&(r=o.responseJSON.message),i.find(".error-message").empty().text(r),i.show("slow")}})},closeEditModal:function(){var e=r(this);e.find("#search-result-title-edit-success").hide(),e.find("#search-result-title-edit-error").hide(),e.find("button").removeAttr("disabled"),e.find("#form_title").data("submit-flag",0),e.find("#form_title").off("keyup"),e.off("submit"),e.off("closed.fndtn.reveal")},"delete":function(e){e.preventDefault(),this.$deleteModal.foundation("reveal","open"),this.$deleteModal.on("submit",{self:this},this.deleteSubmit),this.$deleteModal.on("closed.fndtn.reveal",this.closeDeleteModal)},deleteSubmit:function(e){e.preventDefault(),e.data.self.deleteConfirm()},deleteConfirm:function(){var e=this,t=this.$deleteModal.find("button");this.model.destroy({url:"/api/search/delete/"+this.model.get("id"),timeout:6e4,beforeSend:function(){t.attr("disabled",!0)},success:function(t,o){e.$deleteModal.foundation("reveal","close")},error:function(t,o){var i=e.$deleteModal.find("#search-result-delete-error"),r=o.statusText;void 0!=o.responseJSON&&void 0!=o.responseJSON.message&&(r=o.responseJSON.message),i.find(".error-message").empty().text(r),i.show("slow")}})},closeDeleteModal:function(){var e=r(this);e.find("#search-result-delete-error").hide(),e.find("button").removeAttr("disabled"),e.off("submit"),e.off("closed.fndtn.reveal")}})},{"./../template/index":7,"backbone.marionette":"backbone.marionette","foundation-sites":"foundation-sites",jquery:"jquery"}],10:[function(e,t,o){var i=e("backbone.marionette"),r=(e("backbone"),e("jquery")),a=e("./../template/index"),n=e("./searchResult"),s=e("./empty"),l=e("./../model/searchResult"),d=e("./../collection/searchResults"),u=e("./../model/searchCount");t.exports=i.CompositeView.extend({el:"div#search-result-container",template:a.listContainer,model:u,collection:d,childView:n,childViewContainer:"ul#search-result-lists",emptyView:s,initialize:function(){var e=JSON.parse(r("#search-result-total-items").text());this.model=new u(e);var t=JSON.parse(r("#search-results-info").text());this.collection=new d(t)},onRemoveChild:function(){var e=this,t=this.collection.length;if(0===t)return void location.reload();var o=this.collection.models[t-1].get("id"),i=new l,r=i.url()+o;i.fetch({url:r,success:function(t,o){null!=o.data&&e.collection.add(t)}});var a=this.model.get("total_items")-1;this.model.set("total_items",a),this.$el.find("#total-items").text("計 "+a+" 件")}})},{"./../collection/searchResults":3,"./../model/searchCount":5,"./../model/searchResult":6,"./../template/index":7,"./empty":8,"./searchResult":9,backbone:"backbone","backbone.marionette":"backbone.marionette",jquery:"jquery"}],11:[function(e,t,o){var i=e("backbone.marionette");t.exports=i.AppRouter.extend({appRoutes:{"":"top",top:"top",mypage:"mypage","mypage/index":"mypage","mypage/index/:id":"mypage"}})},{"backbone.marionette":"backbone.marionette"}],12:[function(e,t,o){var i=(e("jquery"),e("./view/searchBox")),r=e("./view/registerBox");t.exports=function(){new i,null!=document.getElementById("register-search-box")&&new r}},{"./view/registerBox":15,"./view/searchBox":16,jquery:"jquery"}],13:[function(e,t,o){var i=e("backbone");t.exports=i.Model.extend({urlRoot:"api/search/save","default":{title:"",start:"",end:"",keyword:"",mode:"",radius:0},parse:function(e){return null!=e.data?e.data:void 0}})},{backbone:"backbone"}],14:[function(e,t,o){var i=e("underscore");t.exports={loader:i.template('<div id="over-lay"></div><div id="search-loader"><i class="fa fa-spinner fa-pulse"></i></div>')}},{underscore:"underscore"}],15:[function(e,t,o){var i=e("jquery"),r=e("backbone.marionette"),a=(e("foundation-sites"),e("./../model/searchResult"));t.exports=r.ItemView.extend({el:"#register-search-box",ui:{searchSaveForm:"#search-save",formTitle:"#form_title",formButton:"#button-search-save",successModal:"#success-modal",failedModal:"#failed-modal"},template:!1,model:null,events:{"submit @ui.searchSaveForm":"submitForm"},initialize:function(){this.bindUIElements(),this._observeInput(),this.model=new a({start:this.ui.searchSaveForm.find("#form_start").val(),end:this.ui.searchSaveForm.find("#form_end").val(),keyword:this.ui.searchSaveForm.find("#form_keyword").val(),mode:this.ui.searchSaveForm.find("#form_mode").val(),radius:this.ui.searchSaveForm.find("#form_radius").val()})},_observeInput:function(){var e=this;this.ui.formTitle.keyup(function(){if(1!=i(this).data("submit-flag")){var t=i(this).val().length;t>0&&50>=t?e.ui.formButton.removeAttr("disabled"):(0===t||t>50)&&e.ui.formButton.attr("disabled",!0)}})},submitForm:function(e){e.preventDefault(),this.ui.searchSaveForm.blur(),console.log(e);var t=this;this.model.set({title:this.ui.formTitle.val()});var o=this.model.url();this.model.save({},{url:o,timeout:6e4,beforeSend:function(){t.ui.formButton.attr("disabled",!0)},success:function(e,o){t.ui.successModal.foundation("reveal","open"),t.ui.formTitle.data("submit-flag",1)},error:function(e,o){o.responseJSON instanceof Object&&null!=o.responseJSON.message&&t.ui.failedModal.find(".error-message").text(o.responseJSON.message),t.ui.failedModal.foundation("reveal","open")}})}})},{"./../model/searchResult":13,"backbone.marionette":"backbone.marionette","foundation-sites":"foundation-sites",jquery:"jquery"}],16:[function(e,t,o){var i=e("jquery"),r=e("backbone.marionette"),a=e("./searchLoader");t.exports=r.ItemView.extend({el:"#search-box",ui:{formSearch:"#form-search",formSearchButton:"#form-search-button"},template:!1,events:{"submit @ui.formSearch":"submitForm"},initialize:function(){this.bindUIElements(),this._initAutoComplete()},_initAutoComplete:function(){google.maps.event.addDomListener(window,"load",function(){var e=document.getElementById("form_start"),t=document.getElementById("form_end"),o={types:[],componentRestrictions:{country:"jp"}};new google.maps.places.Autocomplete(e,o),new google.maps.places.Autocomplete(t,o)})},submitForm:function(e){if(this.ui.formSearch.blur(),this.ui.formSearchButton.attr("disabled",!0),null!=document.getElementById("over-lay"))return!1;var t=new a;t.render(),i(window).on("resize",function(){t.triggerMethod("resize")})}})},{"./searchLoader":17,"backbone.marionette":"backbone.marionette",jquery:"jquery"}],17:[function(e,t,o){var i=e("jquery"),r=e("backbone.marionette"),a=e("./../template/loader");t.exports=r.ItemView.extend({el:"#show-loader",ui:{overLay:"#over-lay",searchLoader:"#search-loader"},template:a.loader,onRender:function(){this.bindUIElements(),this._centeringLoader(),this.ui.overLay.fadeIn("normal"),this.ui.searchLoader.fadeIn("normal")},onResize:function(){this._centeringLoader()},_centeringLoader:function(){var e=(i(window).width()-this.ui.searchLoader.outerWidth(!0))/2,t=(window.innerHeight-this.ui.searchLoader.outerHeight(!0))/2;this.ui.searchLoader.css({left:e+"px"}),this.ui.searchLoader.css({top:t+"px"})}})},{"./../template/loader":14,"backbone.marionette":"backbone.marionette",jquery:"jquery"}]},{},[1]);